<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.solvd.atm.persistence.AtmRepository">

    <update id="decrementAtmCash">
        update Atm a
        set cash = cash - #{money}
        where a.number = #{account.number}
    </update>

    <select id="getAtmInfo" resultMap="getAtmInfoResultMap">
        select
        at.id as atm_id, at.number as atm_number, b.name as bank_name, ad.city as address_city, ad.street as
        address_street, ad.building as address_building
        from
        ATMs at left join banks b
        on at.bank_id = b.id
        left join Addresses ad
        on at.address_id = ad.id
        where
        at.number = #{uniqueNumber}
    </select>

    <resultMap id="getAtmInfoResultMap" type="Atm" autoMapping="false">
        <id property="id" column="atm_id"/>
        <result property="uniqueNumber" column="atm_number"/>
        <association property="bank"
                     resultMap="com.solvd.atm.persistence.BankRepository.BankResultMap"/>
        <association property="address" resultMap="com.solvd.atm.persistence.AddressRepository.AddressResultMap"/>
    </resultMap>

</mapper>